---
title: "**Exposición a Plomo y Mercurio y Riesgo Genético en Alzheimer y Parkinson**"
subtitle: "Un análisis integrador de neurotoxicidad ambiental y susceptibilidad genética"
author: >
  **Rubén Moreno Ortega**  
  **Adrián Orive Rodríguez**  
  **Álvaro Carbonell Pastor**
date: "`r format(Sys.Date(), '%d de %B de %Y')`"
output:
  html_document:
    theme: flatly
    toc: true
    toc_float: true
    toc_depth: 3
    code_folding: show
    number_sections: true
    fig_caption: true
    df_print: paged
    syntax_highlighting: pygments
    css: STYLE.css
---

```{r setup, echo=FALSE, message=FALSE, warning=FALSE}
#carga de todas las librerias necesarias
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(ggrepel)
library(broom)
library(ggplot2)
library(ggrepel)
library(rnaturalearth)
library(rnaturalearthdata)
library(sf)
library(ggplot2)
library(dplyr)
library(plotly)
library(kableExtra)
```
# Introducción
La prevalencia global de patologías neurodegenerativas como **Alzheimer** y **Parkinson** representa uno de los principales retos en biomedicina contemporánea. Diversos estudios epidemiológicos y moleculares han demostrado que ambos trastornos tienen una etiología multifactorial, en la que interactúan componentes genéticos, epigenéticos y ambientales.

## Genética y metales pesados como factores de riesgo

Desde los primeros GWAS se han identificado variantes genéticas de riesgo para el alzheimer y para parkinson. Estas variantes no solo modulan la susceptibilidad, sino también la progresión, la edad de inicio y las manifestaciones clínicas de la enfermedad. Sin embargo, la penetrancia de estos alelos es incompleta, lo que sugiere la intervención de factores externos.

Entre los factores ambientales, la exposición crónica a metales pesados como plomo (Pb) y mercurio (Hg) ha cobrado relevancia. Estos elementos participan en mecanismos reconocidos de neurotoxicidad: estrés oxidativo, disfunción mitocondrial, agregación proteica y alteración de los sistemas de reparación celular.


# Metodología
En este informe, exploramos la relación entre la exposición a metales pesados, específicamente plomo y mercurio, y el riesgo genético asociado con enfermedades neurodegenerativas como el Alzheimer y el Parkinson. Utilizando datos de biomonitorización y estadísticas de mortalidad, analizamos cómo estos factores pueden influir en la incidencia de estas enfermedades en diferentes países.

La metodología seguida en este estudio incluye la recopilación y filtrado de datos relevantes, la integración de diferentes fuentes de información y el análisis estadístico para identificar posibles correlaciones entre la exposición a metales pesados y su incidencia en las enfermedades del Alzheimer y Parkinson.

## Mapa de los países del estudio
```{r mapa-europa, message=FALSE, warning=FALSE}
# Descargar datos de Europa
# (Usamos scale = "large" para mejor definición de las costas)
europa <- ne_countries(continent = "Europe", scale = "medium", returnclass = "sf")

# Los países a marcar
# Nota: Cambiado "Czech Republic" a "Czechia" que es más común en los datos
paises_estudio <- c("Germany", "Spain", "Belgium", "Czechia", "Norway", "Slovenia")

# Añadir columna para destacar países
europa <- europa %>%
  mutate(Estudio = ifelse(name %in% paises_estudio, "Estudio", "Otros"))

# --- Graficar con la proyección corregida ---
ggplot(europa) +
  geom_sf(aes(fill = Estudio), color = "gray30", linewidth = 0.2) +
  scale_fill_manual(values = c("Estudio" = "#ED7D31", "Otros" = "lightgray")) +
  
  # --- ESTA ES LA PARTE CLAVE ---
  # Define una proyección (CRS) centrada en Europa (EPSG:3035)
  # y establece límites para "hacer zoom" y recortar las partes lejanas.
  coord_sf(
    crs = st_crs(3035),
    xlim = c(2500000, 6000000),
    ylim = c(1500000, 5500000)
  ) +
  # ------------------------------
  
  labs(title = "Países del estudio sobre metales y genética en Europa",
       fill = "Participación") +
  theme_void()
```

```{r load-data, echo=FALSE}
df <- read_csv("results/muertesAlzheimer_HgPb.csv", show_col_types = FALSE)
df2 <- read_csv("results/muertesParkinson_HgPb.csv", show_col_types = FALSE)
```

# Mortalidad por Alzheimer y su relacion con los niveles de plomo y mercurio
Esta pregunta resume un análisis exploratorio sobre la relación entre las concentraciones poblacionales de mercurio (Hg) y plomo (Pb) en sangre (percentil P50) y el número estimado de muertes por Alzheimer por país y año.

Nota importante: la variable `numero_muertes` no es un conteo exacto sino una estimación (por eso tiene decimales). El valor original suele disponer de un intervalo (límite inferior y superior); aquí trabajamos con la media.



## ¿El nivel del metal predice el número de muertes?

Vamos a ver esto mediante un gráfico de dispersión con línea de regresión, separado en dos gráficos (uno para Hg y otro para Pb). Cada gráfico mostrará el número de muertes en el eje Y y el nivel del metal en el eje X.
```{r plot-correlaciones, echo=FALSE, fig.width=10}
# 1. Separar los datos
df_pb <- filter(df, metal == "Pb")
df_hg <- filter(df, metal == "Hg")

# 2. Gráfico para Plomo (Pb)
plot_pb <- ggplot(df_pb, aes(x = value, y = numero_muertes, 
                           label = country, year = year)) + # Añadimos info para el tooltip
  geom_point(aes(color = country), size = 3) +
  geom_smooth(method = "lm", color = "black", se = FALSE) +
  # ggrepel es genial para estático, pero lo quitamos para plotly
  # geom_text_repel(aes(label = paste(country, year, sep = "-")), size = 2.5) +
  labs(
    title = "Correlación entre Plomo (Pb P50) y Muertes por Alzheimer",
    y = "Número Estimado de Muertes",
    x = "Nivel de Plomo (P50) en µg/L"
  ) +
  theme_bw()

# 3. Gráfico para Mercurio (Hg)
plot_hg <- ggplot(df_hg, aes(x = value, y = numero_muertes,
                           label = country, year = year)) + # Añadimos info para el tooltip
  geom_point(aes(color = country), size = 3) +
  geom_smooth(method = "lm", color = "black", se = FALSE) +
  # geom_text_repel(aes(label = paste(country, year, sep = "-")), size = 2.5) +
  labs(
    title = "Correlación entre Mercurio (Hg P50) y Muertes por Alzheimer",
    y = "Número Estimado de Muertes",
    x = "Nivel de Mercurio (P50) en µg/L"
  ) +
  theme_bw()

# 4. Imprimimos los gráficos con plotly (¡pasa el ratón por encima!)
# ggplotly los convierte en interactivos
ggplotly(plot_pb)
ggplotly(plot_hg)
```

### Gráfico 1: Correlación entre Plomo (Pb P50) y Muertes por Parkinson

Si nos fijamos en la línea de regresión (línea negra), podemos ver una **tendencia negativa**. A medida que aumentan los niveles de plomo, las muertes por Alzheimer parecen disminuir.

* **Alemania** muestra la mayor cantidad de muertes, pero con niveles bajos de plomo.
* Por el contrario, **Bélgica (2005)** y la **República Checa** presentan niveles más altos de plomo, pero un número de muertes comparativamente bajo.

**Conclusión:** Los datos parecen indicar una **correlación negativa** entre los niveles de plomo y las muertes por Alzheimer. Esto **resulta contradictorio desde un punto de vista biológico**, por lo que podemos deducir que hay otros factores (factores de confusión), los cuales no tenemos en cuenta en nuestro estudio, que están afectando de manera mucho más significativa al resultado.

### Gráfico 2: Correlación entre Mercurio (Hg P50) y Muertes por Alzheimer

En este caso, la línea de regresión negra muestra una **ligera pendiente positiva**. Sin embargo, los puntos se encuentran muy dispersos y no siguen un patrón claro.

* **Alemania** nuevamente muestra la mayor cantidad de muertes, pero con niveles moderados de mercurio.
* **España** presenta los niveles más altos de mercurio del conjunto de datos, pero con un número de muertes inferior al de Alemania.

**Conclusión:** Los datos parecen indicar que **no hay una relación clara** o estadísticamente significativa entre el número de muertes por Alzheimer y los niveles de mercurio reportados.


## ANALISIS NUMERICO

```{r}
# 1. Separar los datos
df_pb <- filter(df, metal == "Pb")
df_hg <- filter(df, metal == "Hg")

# 2. Correr los modelos lineales
modelo_pb <- lm(numero_muertes ~ value, data = df_pb)
modelo_hg <- lm(numero_muertes ~ value, data = df_hg)

# 3. Presentar los resultados en una tabla limpia
tabla_pb <- tidy(modelo_pb)
tabla_hg <- tidy(modelo_hg)

# Usamos kable() para tablas bonitas en R Markdown
knitr::kable(tabla_pb, digits = 3, caption = "Modelo Lineal: Muertes por Alzheimer ~ Nivel de Plomo (Pb)")

knitr::kable(tabla_hg, digits = 3, caption = "Modelo Lineal: Muertes por Alzheimer ~ Nivel de Mercurio (Hg)")
```
### Modelo 1: Muertes por Alzheimer ~ Nivel de Plomo (Pb)
El modelo muestra que el intercepto (74260.043) representa el número estimado de muertes por Alzheimer cuando el nivel de plomo es cero. El coeficiente del plomo (-2231.546) indica que, por cada unidad adicional de este metal, las muertes por Alzheimer disminuyen en promedio 2231.5 unidades. Dado que el p-valor (0.002) es menor a 0.05, la relación resulta estadísticamente significativa. Sin embargo, el signo negativo del coeficiente refleja una relación inversa, lo cual es contraintuitivo desde un punto de vista biológico.

### Modelo 2: Muertes por Alzheimer ~ Nivel de Mercurio (Hg)
El modelo indica que el intercepto (23311.106) representa el número estimado de muertes por Alzheimer cuando el nivel de mercurio es cero. El coeficiente del mercurio (334.402) sugiere un leve aumento en las muertes por Alzheimer con mayores niveles de este metal; sin embargo, el p-valor (0.947) muestra que la relación no es estadísticamente significativa. Por tanto, no se puede afirmar que el mercurio tenga un efecto real sobre las muertes por Alzheimer en esta muestra. 

Ambos analisis concuerdan con lo visto en los graficos anteriores. 

## ¿Se observa patrón temporal en la exposición (disminución/aumento) y cómo se relaciona con cambios en mortalidad?
Dentro de esta pregunta tenemos dos objetivos:

&middot;Evaluar el patron tempporal de Exposición, es decir, analizar los niveles de estos metales en la población (dentro de los países usados como muestra) a lo largo de los años, buscando algún patrón que nos muestre indicios de aumento o disminución en la exposición.

&middot;Relacionar la tendencia con la mortalidad, indagar como la dinámica temporal en la exposición puede relacionarse con los cambios en el número estimado de muertes causadas por Alzheimer 

En primer lugar, vamos a observar un gráfico donde podemos observar esta evolución de las concentraciones de los metales pesados en la sangre. 

```{r grafico-tendencia-metales, fig.width=10, fig.height=5}
temporal_plot <- ggplot(df, aes(x = year, y = value, color = country, group = country)) +
  geom_line(linewidth = 1) + 
  geom_point(size = 3) +       
  facet_wrap(~ metal, scales = "free_y") +
  labs(
    title = "Tendencia Temporal de la Exposición a Metales Pesados (P50) por País",
    y = "Nivel del Metal (P50) en µg/L",
    x = "Año",
    color = "País"
  ) +
  theme_bw() + 
  theme(legend.position = "bottom",
        plot.title = element_text(face = "bold"))

temporal_plot
```
Como podemos observar en los gráficos que se observan en la parte superior, hay casos distintos para los metales que estamos analizando. 

En el caso del Plomo (Pb), hay una clara disminución de la concentración de plomo en sangre (P50) en todos los paisses con múltiples mediciones a lo largo de los años.Esto es un reflejo del éxito de las políticas de salud pública y las regulaciones ambientales. Para nuestro estudio este descenso es el principal factor de confusión que explica la relación negativa y contraintuitiva en los gráficos de dispersión. Vemos como la exposición al Plomo no se ha mantenido estable, sino que ha caido drásticamente debido a factores externos

Si hablamos del Mercurio, podemos comprobar que la exposición del Mercurio es mucho más estable a lo largo del tiempo, con una disminución más gradual y ligera en países como la República Checa y Alemania. La falta de una caída dramática sugiere que los factores regulatorios operan de manera diferente.

El segundo paso, es probar si existe algún tipo de correlación entre la evolución temporal de la exposición y el número de muertes por Alzheimer. Para ello, vamos a crear un gráfico de dispersión similar a los anteriores, pero en este caso, vamos a conectar los puntos de cada país con flechas que indiquen la dirección temporal (de años más antiguos a más recientes). Esto nos permitirá visualizar cómo ha cambiado la relación entre la exposición y las muertes a lo largo del tiempo.

```{r grafico-relacion-alzheimer-Plomo, fig.width=9, fig.height=6}



df_pb_multi_year_alz <- df %>%
  filter(metal == "Pb") %>%
  group_by(country) %>%
  filter(n() > 1) %>% 
  ungroup()


df_scaled_alz <- df_pb_multi_year_alz %>%
  group_by(country) %>%
  mutate(
    scaled_muertes = scales::rescale(numero_muertes, to = range(value, na.rm = TRUE)),
    actual_muertes = numero_muertes 
  ) %>%
  ungroup()


p_combined_trends_alz <- ggplot(df_scaled_alz, aes(x = year, group = country)) +
  
  geom_line(aes(y = value, color = country, linetype = "Plomo (Pb)"), size = 1) +
  geom_point(aes(y = value, color = country, 
                 text = paste("País:", country, "<br>Año:", year, "<br>Plomo (P50):", round(value, 2), "µg/L")), 
             size = 3) +

  geom_line(aes(y = scaled_muertes, color = country, linetype = "Muertes Alzheimer (Escalado)"), size = 1, alpha = 0.7) +
  geom_point(aes(y = scaled_muertes, color = country, 
                 text = paste("País:", country, "<br>Año:", year, "<br>Muertes Alzheimer:", round(actual_muertes, 0), "<br>Muertes (Escalado):", round(scaled_muertes, 2))), 
             size = 3, alpha = 0.7) +
  facet_wrap(~ country, scales = "free_y", ncol = 2) + 
  scale_linetype_manual(name = "Métrica", values = c("Plomo (Pb)" = "solid", "Muertes Alzheimer (Escalado)" = "dashed")) +
  labs(
    title = "Evolución Temporal de Plomo (P50) y Muertes por Alzheimer",
    subtitle = "Los datos de muertes por Alzheimer se han escalado para visualización conjunta. Observe las tendencias opuestas.",
    y = "Nivel (µg/L) / Muertes (Escalado)",
    x = "Año",
    color = "País"
  ) +
  theme_bw() +
  theme(legend.position = "bottom",
        plot.title = element_text(face = "bold"),
        strip.text = element_text(face = "bold"))


ggplotly(p_combined_trends_alz, tooltip = "text")
```

En el gráfico anterior podemos acabar de concluir lo que se puede intuir en el anterior y demostrando que lo que se menciona en gráficos superiores esta en lo correcto. Debido a que el Plomo disminuye mientras que las muertes aumentan simultáneamente a lo largo del tiempo, y como se mencionaba anteriormente se establece una Correlación Negativa (a mayor cantidad de plomo, menor número de muertes), lo cuál es lo opuesto a lo esperado cuando estamos hablando de una neurotoxina que puede resultar perjudicial en otros muchos aspectos. El patrón que hemos observado es crucial porque demuestra que la correlación entre estas dos variables y la mortalidad no es una simple relación causal biológica, sino un mero artefacto estadístico impulsado por el factor de confusión demográfico que enmascara cualquier posible efecto de los metales

````{r grafico-relacion-alzheimer-Mercurio, fig.width=9, fig.height=6}


df_hg_multi_year_alz <- df %>%
  filter(metal == "Hg") %>%
  group_by(country) %>%
  filter(n() > 1) %>% 
  ungroup()


df_scaled_hg_alz <- df_hg_multi_year_alz %>%
  group_by(country) %>%
  mutate(
    scaled_muertes = scales::rescale(numero_muertes, to = range(value, na.rm = TRUE)),
    actual_muertes = numero_muertes 
  ) %>%
  ungroup()


p_combined_trends_hg_alz <- ggplot(df_scaled_hg_alz, aes(x = year, group = country)) +

  geom_line(aes(y = value, color = country, linetype = "Mercurio (Hg)"), size = 1) +
  geom_point(aes(y = value, color = country, 
                 text = paste("País:", country, "<br>Año:", year, "<br>Mercurio (P50):", round(value, 2), "µg/L")), 
             size = 3) +
  
  geom_line(aes(y = scaled_muertes, color = country, linetype = "Muertes Alzheimer (Escalado)"), size = 1, alpha = 0.7) +
  geom_point(aes(y = scaled_muertes, color = country, 
                 text = paste("País:", country, "<br>Año:", year, "<br>Muertes Alzheimer:", round(actual_muertes, 0), "<br>Muertes (Escalado):", round(scaled_muertes, 2))), 
             size = 3, alpha = 0.7) +
  facet_wrap(~ country, scales = "free_y", ncol = 2) +
  scale_linetype_manual(name = "Métrica", values = c("Mercurio (Hg)" = "solid", "Muertes Alzheimer (Escalado)" = "dashed")) +
  labs(
    title = "Evolución Temporal de Mercurio (P50) y Muertes por Alzheimer",
    subtitle = "Los datos de muertes por Alzheimer se han escalado para visualización conjunta. El Mercurio muestra mayor estabilidad que el Plomo.",
    y = "Nivel (µg/L) / Muertes (Escalado)",
    x = "Año",
    color = "País"
  ) +
  theme_bw() +
  theme(legend.position = "bottom",
        plot.title = element_text(face = "bold"),
        strip.text = element_text(face = "bold"))


ggplotly(p_combined_trends_hg_alz, tooltip = "text")
````

El gráfico de evolución temporal conjunta del Mercurio y la mortalidad por Alzheimer confirma la falta de significancia estadística que ya se había observado en los modelos iniciales.

Dado que la exposición al Mercurio es estable y las muertes por Alzheimer aumentan, no se produce el fenómeno de las "tendencias opuestas" que generó el sesgo en el caso del plomo. En consecuencia, el análisis temporal corrobora la conclusión inicial: no existe una correlación clara ni estadísticamente significativa entre los niveles de Mercurio y los cambios en la mortalidad por Alzheimer en esta muestra agregada. El Hg no actúa como un impulsor de la correlación espuria, sino que simplemente demuestra la ausencia de una relación detectable a este nivel de análisis.

# Mortalidad por Parkinson y su relacion con los niveles de plomo y mercurio
Esta pregunta resume un análisis exploratorio sobre la relación entre las concentraciones poblacionales de mercurio (Hg) y plomo (Pb) en sangre (percentil P50) y el número estimado de muertes por Parkinson por país y año.

Nota importante: la variable `numero_muertes` no es un conteo exacto sino una estimación (por eso tiene decimales). El valor original suele disponer de un intervalo (límite inferior y superior); aquí trabajamos con la media.

## ¿El nivel del metal predice el número de muertes?

Vamos a ver esto mediante un gráfico de dispersión con línea de regresión, separado en dos gráficos (uno para Hg y otro para Pb). Cada gráfico mostrará el número de muertes en el eje Y y el nivel del metal en el eje X.
```{r plot-correlaciones2, echo=FALSE, fig.width=10}
# 1. Separar los datos
df_pb2 <- filter(df2, metal == "Pb")
df_hg2 <- filter(df2, metal == "Hg")

# 2. Gráfico para Plomo (Pb)
plot_pb2 <- ggplot(df_pb2, aes(x = value, y = numero_muertes,
                             label = country, year = year)) + # Info para tooltip
  geom_point(aes(color = country), size = 3) +
  geom_smooth(method = "lm", color = "black", se = FALSE) +
  labs(
    title = "Correlación entre Plomo (Pb P50) y Muertes por Parkinson",
    y = "Número Estimado de Muertes",
    x = "Nivel de Plomo (P50) en µg/L"
  ) +
  theme_bw()

# 3. Gráfico para Mercurio (Hg)
plot_hg2 <- ggplot(df_hg2, aes(x = value, y = numero_muertes,
                             label = country, year = year)) + # Info para tooltip
  geom_point(aes(color = country), size = 3) +
  geom_smooth(method = "lm", color = "black", se = FALSE) +
  labs(
    title = "Correlación entre Mercurio (Hg P50) y Muertes por Parkinson",
    y = "Número Estimado de Muertes",
    x = "Nivel de Mercurio (P50) en µg/L"
  ) +
  theme_bw()

# 4. Imprimimos los gráficos con plotly
ggplotly(plot_pb2)
ggplotly(plot_hg2)
```

### Gráfico 1: Correlación entre Plomo (Pb P50) y Muertes por Parkinson

Si nos fijamos en la línea de regresión (línea negra), podemos ver una **tendencia negativa**. A medida que aumentan los niveles de plomo, las muertes por Parkinson parecen disminuir.

* **Alemania** muestra la mayor cantidad de muertes, pero con niveles bajos de plomo.
* Por el contrario, **Bélgica (2005)** y la **República Checa** presentan niveles más altos de plomo, pero un número de muertes comparativamente bajo.

**Conclusión:** Los datos parecen indicar una **correlación negativa** entre los niveles de plomo y las muertes por Parkinson. Esto **resulta contradictorio desde un punto de vista biológico**, por lo que podemos deducir que hay otros factores (factores de confusión), los cuales no tenemos en cuenta en nuestro estudio, que están afectando de manera mucho más significativa al resultado.

### Gráfico 2: Correlación entre Mercurio (Hg P50) y Muertes por Parkinson

En este caso, la línea de regresión negra muestra una **ligera pendiente positiva**. Sin embargo, los puntos se encuentran muy dispersos y no siguen un patrón claro.

* **Alemania** nuevamente muestra la mayor cantidad de muertes, pero con niveles moderados de mercurio.
* **España** presenta los niveles más altos de mercurio del conjunto de datos, pero con un número de muertes inferior al de Alemania.

**Conclusión:** Los datos parecen indicar que **no hay una relación clara** o estadísticamente significativa entre el número de muertes por Parkinson y los niveles de mercurio reportados.


## ANALISIS NUMERICO

```{r}
# 1. Separar los datos
df_pb_parkinson <- filter(df2, metal == "Pb")
df_hg_parkinson <- filter(df2, metal == "Hg")

# 2. Correr los modelos lineales
modelo_pb2 <- lm(numero_muertes ~ value, data = df_pb_parkinson)
modelo_hg2 <- lm(numero_muertes ~ value, data = df_hg_parkinson)

# 3. Presentar los resultados en una tabla limpia
tabla_pb2 <- tidy(modelo_pb2)
tabla_hg2 <- tidy(modelo_hg2)

# Usamos kable() para tablas bonitas en R Markdown
knitr::kable(tabla_pb2, digits = 3, caption = "Modelo Lineal: Muertes por Parkinson ~ Nivel de Plomo (Pb)")

knitr::kable(tabla_hg2, digits = 3, caption = "Modelo Lineal: Muertes por Parkinson ~ Nivel de Mercurio (Hg)")
```
### Modelo 1: Muertes por Parkinson ~ Nivel de Plomo (Pb)
El modelo muestra que el intercepto (13868.262) representa el número estimado de muertes por Parkinson cuando el nivel de plomo es cero. El coeficiente del plomo (-412.033) indica que, por cada unidad adicional de este metal, las muertes por Parkinson disminuyen en promedio 412.033 unidades. Dado que el p-valor (0.003) es menor a 0.05, la relación resulta estadísticamente significativa. Sin embargo, el signo negativo del coeficiente refleja una relación inversa, lo cual es contraintuitivo desde un punto de vista biológico.

### Modelo 2: Muertes por Parkinson ~ Nivel de Mercurio (Hg)
El modelo indica que el intercepto (4620.02) representa el número estimado de muertes por Parkinson cuando el nivel de mercurio es cero. El coeficiente del mercurio (48.81) sugiere un leve aumento en las muertes por Parkinson con mayores niveles de este metal; sin embargo, el p-valor (0.960) muestra que la relación no es estadísticamente significativa. Por tanto, no se puede afirmar que el mercurio tenga un efecto real sobre las muertes por Parkinson en esta muestra.

Ambos analisis concuerdan con lo visto en los graficos anteriores. 

## CONCLUSION
Al comparar los análisis de ambas enfermedades neurodegenerativas, emerge un patrón consistente. En ambos casos, los niveles de mercurio (Hg) no muestran una relación estadísticamente significativa con la mortalidad. Por otro lado, el plomo (Pb) presenta para ambas patologías una correlación negativa y estadísticamente significativa (p-valores de 0.002 y 0.003, respectivamente).

El hecho de que a mas plomo haya menos muertes es biológicamente contraintuitivo, y el hecho de que se repita de forma idéntica tanto en el Alzheimer como en el Parkinson, refuerza la hipótesis de que no estamos ante una relación causal. Lo mas probable que estemos observando el efecto de uno o más factores de confusión. Por ejemplo, es normal que los países con mayor esperanza de vida y mejores sistemas de diagnóstico (como Alemania) reporten, más muertes por estas enfermedades, mientras que, poseen regulaciones ambientales más estrictas que resultan en niveles de plomo más bajos. Esta correlación nos indica la necesidad de incluir más variables.


## ¿Se observa patrón temporal en la exposición (disminución/aumento) y cómo se relaciona con cambios en mortalidad?


A continuación, verificamos si el mecanismo de la correlación espuria se repite en la mortalidad por Parkinson, ya que el análisis estadístico inicial también mostró una relación negativa significativa con la exposición al Plomo. 


```{r grafico-relacion-parkinson, fig.width=10, fig.height=6}
# Cargar librerías necesarias (si no están ya en el setup)
library(ggplot2)
library(dplyr)
library(ggrepel)

# 1. Filtrar solo los datos de Plomo (Pb) USANDO LA VARIABLE CORRECTA (df2)
df_pb_parkinson <- filter(df2, metal == "Pb") 

# 2. Crear el gráfico de dispersión con la trayectoria temporal
grafico_relacion_temporal_parkinson <- ggplot(df_pb_parkinson, aes(x = value, y = numero_muertes, group = country)) +

  # Línea de regresión (muestra la correlación negativa general)
  geom_smooth(method = "lm", color = "black", se = FALSE, linewidth = 0.5) +
  
  # AÑADIR LA RUTA TEMPORAL (flechas que conectan los años, de antiguo a reciente)
  geom_path(aes(color = country),
            arrow = arrow(length = unit(0.3, "cm"), ends = "last"),
            alpha = 0.6) +
  
  # Mostrar los puntos y etiquetarlos con el año para ver la evolución
  geom_point(aes(color = country), size = 3) +
  geom_text_repel(aes(label = year), size = 3, max.overlaps = 20) +
  
  labs(
    title = "Trayectoria Temporal: Relación entre Exposición a Plomo (Pb) y Muertes por Parkinson",
    subtitle = "El mismo patrón de movimiento (regulación) confirma que el factor de confusión es idéntico al observado en Alzheimer.",
    y = "Número Estimado de Muertes por Parkinson",
    x = "Nivel de Plomo (P50) en µg/L",
    color = "País"
  ) +
  theme_bw() +
  theme(legend.position = "bottom",
        plot.title = element_text(face = "bold"))

grafico_relacion_temporal_parkinson
```
